<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Getting started with Apache Avro | Idarlington </title> <meta name="description" content=" Guide to understanding apache avro and setting up avro schemas "> <meta name="keywords" content="Avro, Apache Avro, Avro Schema"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="IKenna D. Ogbajie"> <meta property="article:section" content=""> <meta property="article:tag" content="Avro, Apache Avro, Avro Schema"> <meta property="article:published_time" content="2017-03-30 00:00:00 +0200"> <meta property="og:url" content="http://localhost:4000/2017/Getting-started-avro/"> <meta property="og:title" content=" Getting started with Apache Avro | Idarlington "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" Guide to understanding apache avro and setting up avro schemas "> <meta property="og:site_name" content="IKenna D. Ogbajie"> <meta property="og:locale" content=""> <!-- Social: Twitter --> <meta name="twitter:card" content=""> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Getting started with Apache Avro | Idarlington "> <meta name="twitter:description" content=" Guide to understanding apache avro and setting up avro schemas "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Getting started with Apache Avro | Idarlington "> <meta itemprop="description" content=" Guide to understanding apache avro and setting up avro schemas "> <meta itemprop="image" content="http://localhost:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/2017/Getting-started-avro/"> <link rel="alternate" type="application/rss+xml" title="Idarlington" href="http://localhost:4000/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'idarlington'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-50842645-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"> </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} }); </script> </head> <body> <main id="site-top" class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Idarlington</a></h1> <ul class="navbar"> <li><a href="/tags">tags</a></li> <li><a href="/about">about</a></li> <li><a href="/feed.xml" target="_blank">feed</a></li> </ul> </div> </nav> </header> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80946846-1', 'auto'); ga('send', 'pageview'); </script> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Getting started with Apache Avro</h1> <p class="post-meta"> <a class="tag" href="/tags#Avro">Avro</a> | <time datetime="2017-03-30T00:00:00+02:00" itemprop="datePublished">Mar 30, 2017</time> </p> </header> <div class="post-content" itemprop="articleBody"> <style> ul { list-style-type: square; margin-bottom: 10px; padding-left: 30px; } ol { list-style-type: decimal; margin-bottom: 10px; padding-left: 30px; } h3 strong { font-weight:normal; } </style> <h2 id="what-is-avro-">What is Avro ?</h2> <p>Avro is a data serialisation and <a href="https://en.wikipedia.org/wiki/Remote_procedure_call">RPC</a> system like protobuff and thrift. It relies on a schema-based system. This schema is in JSON which is an advantage as most languages already have JSON libraries. Avro was originally developed by <a href="https://twitter.com/cutting">Doug Cutting</a> to provide data serialisation and data exchange services for hadoop. It has since evolved to serve other technologies apart from hadoop.</p> <p>Theoretically, Avro can be used in any language but it has APIs for PHP, Java, Perl, Python, C, C++, C#, Go, Haskell and Ruby.</p> <h2 id="where-avro-shines">Where Avro shines</h2> <p>Comparing Avro with similar systems (protobuff, thrift, message pack), these are the areas where it differs :</p> <ul> <li> <p><em>Dynamic typing:</em></p> <p>Serialisation and deserialization can be done without code generation. Code generation is also available for statically typed languages as an optional optimisation.</p> </li> <li> <p><em>Schema evolution:</em></p> <p>Avro requires schemas when data is written or read. Most interesting is that you can use different schemas for serialisation and deserialization, and Avro will handle the missing/extra/modified fields.</p> </li> <li> <p><em>Untagged data:</em></p> <p>Other serialisation systems like protobuff tag data but providing a schema with binary data allows each datum be written without the overhead. The result is more compact data encoding and faster data processing.</p> </li> </ul> <h2 id="why-you-need-avro-or-serialisation-libraries-generally">Why you need Avro (or serialisation libraries generally):</h2> <ul> <li>You save storage space. <a href="https://eng.uber.com/trip-data-squeeze/">Uber</a> drastically reduced their storage needs by implementing data serialization and compression.</li> <li>It significantly reduces the amount of time spent processing data.</li> <li>Translates to less money saved on provisioning hardware.</li> </ul> <h2 id="data-types-in-avro">Data types in Avro</h2> <p>Avro supports a range of data types. These types could be either primitive, complex or logical types.</p> <h3 id="primitive-types">Primitive types:</h3> <ol> <li><em>null :</em> no value</li> <li><em>boolean :</em> a binary value</li> <li><em>int :</em> 32-bit signed integer</li> <li><em>long :</em> 64-bit signed integer</li> <li><em>float :</em> single precision (32-bit) IEEE 754 floating-point number</li> <li><em>double :</em> double precision (64-bit) IEEE 754 floating-point number</li> <li><em>bytes :</em> sequence of 8-bit unsigned bytes</li> <li><em>string :</em> Unicode character sequence</li> </ol> <h3 id="complex-types">Complex Types:</h3> <p>Avro also provides complex data types which are majorly a combination of primitive types. The complex types are:</p> <ol> <li> <h4 id="records"><em>Records:</em></h4> <p>A record is a collection of multiple types. A record is equivalent to a JSON object or a dictionary in python.</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span><span class="s2">"record"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span><span class="s2">"Point"</span><span class="p">,</span>
    <span class="s2">"fields"</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"x"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span><span class="s2">"int"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"y"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span><span class="s2">"int"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></figure> </li> <li> <h4 id="enum"><em>Enum:</em></h4> <p>An enumeration is a list of items in a collection.</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span><span class="s2">"enum"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span><span class="s2">"Suit"</span><span class="p">,</span>
    <span class="s2">"symbols"</span><span class="p">:[</span>
        <span class="s2">"SPADES"</span><span class="p">,</span>
        <span class="s2">"HEARTS"</span><span class="p">,</span>
        <span class="s2">"DIAMONDS"</span><span class="p">,</span>
        <span class="s2">"CLUBS"</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></figure> </li> <li> <h4 id="arrays"><em>Arrays:</em></h4> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">" type "</span> <span class="p">:</span> <span class="s2">" array "</span><span class="p">,</span> <span class="s2">" items "</span> <span class="p">:</span> <span class="s2">" int "</span> <span class="p">}</span></code></pre></figure> </li> <li> <h4 id="maps"><em>Maps:</em></h4> <p>Map keys are assumed to be strings. Eg :</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"map"</span><span class="p">,</span> <span class="s2">"values"</span><span class="p">:</span> <span class="s2">"long"</span><span class="p">}</span></code></pre></figure> </li> <li> <h4 id="unions"><em>Unions:</em></h4> <p>Unions are represented using JSON arrays.</p> <p><code class="highlighter-rouge">["null", "string"]</code> declares a schema which may be either a null or string.</p> </li> <li> <h4 id="fixed"><em>Fixed:</em></h4> <p>This data type is used to declare a fixed-sized field that can be used for storing binary data. It has field name and data as attributes. Name holds the name of the field, and size holds the size of the field.</p> </li> </ol> <h2 id="defining-a-schema">Defining a schema</h2> <p>As indicated, Avro schemas are defined with JSON. The Schema is a representation of the data to be serialized in avro data types.</p> <p>Creating a schema for this Object</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">"products"</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"A green door"</span><span class="p">,</span>
            <span class="s2">"price"</span><span class="p">:</span><span class="mf">12.50</span><span class="p">,</span>
            <span class="s2">"tags"</span><span class="p">:[</span>
                <span class="s2">"home"</span><span class="p">,</span>
                <span class="s2">"green"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"A green door"</span><span class="p">,</span>
            <span class="s2">"price"</span><span class="p">:</span><span class="mf">12.50</span><span class="p">,</span>
            <span class="s2">"tags"</span><span class="p">:[</span>
                <span class="s2">"home"</span><span class="p">,</span>
                <span class="s2">"green"</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"A green door"</span><span class="p">,</span>
            <span class="s2">"price"</span><span class="p">:</span><span class="mf">12.50</span><span class="p">,</span>
            <span class="s2">"tags"</span><span class="p">:[</span>
                <span class="s2">"home"</span><span class="p">,</span>
                <span class="s2">"green"</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></figure> <p>would result in :</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">"namespace"</span><span class="p">:</span><span class="s2">"com.idarlington.avro"</span><span class="p">,</span>
    <span class="s2">"type"</span><span class="p">:</span><span class="s2">"record"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span><span class="s2">"stream"</span><span class="p">,</span>
    <span class="s2">"fields"</span><span class="p">:[</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"products"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:{</span>
                <span class="s2">"type"</span><span class="p">:</span><span class="s2">"array"</span><span class="p">,</span>
                <span class="s2">"items"</span><span class="p">:{</span>
                    <span class="s2">"name"</span><span class="p">:</span><span class="s2">"product"</span><span class="p">,</span>
                    <span class="s2">"type"</span><span class="p">:</span><span class="s2">"record"</span><span class="p">,</span>
                    <span class="s2">"fields"</span><span class="p">:[</span>
                        <span class="p">{</span>
                            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"id"</span><span class="p">,</span>
                            <span class="s2">"type"</span><span class="p">:</span><span class="s2">"integer"</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"name"</span><span class="p">,</span>
                            <span class="s2">"type"</span><span class="p">:</span><span class="s2">"string"</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"price"</span><span class="p">,</span>
                            <span class="s2">"type"</span><span class="p">:</span><span class="s2">"float"</span>
                        <span class="p">},</span>
                        <span class="p">{</span>
                            <span class="s2">"name"</span><span class="p">:</span><span class="s2">"tags"</span><span class="p">,</span>
                            <span class="s2">"type"</span><span class="p">:{</span>
                                <span class="s2">"type"</span><span class="p">:</span><span class="s2">"array"</span><span class="p">,</span>
                                <span class="s2">"items"</span><span class="p">:</span><span class="s2">"string"</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span></code></pre></figure> <p>To validate and test your avro schema, you can check <a href="http://sh6.tarantool.org/">this</a> out.</p> <p>My next post would be on serialzing and deserializing with Avro. If you like this post, please share ♥.</p> <aside class="share"> <h4>Share this.</h4> <a href="http://twitter.com/share?text=Getting started with Apache Avro&amp;url=http://localhost:4000/2017/Getting-started-avro/&amp;hashtags=Avro&amp;via=idarlington" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2017/Getting-started-avro/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <aside id="comments" class="disqus"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'idarlington'; var disqus_identifier = '/2017/Getting-started-avro'; var disqus_title = 'Getting started with Apache Avro'; var disqus_url = 'http://localhost:4000'; /*var disqus_developer = 1;*/ (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a> </noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> <!--<small class="pull-right">theme by <a href="http://nandomoreira.me/" target="_blank">nandomoreira.me</a></small>--> </div> </footer> </main> </body> </html>
