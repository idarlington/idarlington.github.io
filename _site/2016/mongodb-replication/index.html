<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> MongoDB Replication | Idarlington </title> <meta name="description" content=" About replication and Configuring a MongoDB replica set "> <meta name="keywords" content="MongoDB, replica set, replication, MongoDB Replication"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="IKenna D. Ogbajie"> <meta property="article:section" content=""> <meta property="article:tag" content="MongoDB, replica set, replication, MongoDB Replication"> <meta property="article:published_time" content="2016-11-14 00:00:00 +0100"> <meta property="og:url" content="http://localhost:4000/2016/mongodb-replication/"> <meta property="og:title" content=" MongoDB Replication | Idarlington "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" About replication and Configuring a MongoDB replica set "> <meta property="og:site_name" content="IKenna D. Ogbajie"> <meta property="og:locale" content=""> <!-- Social: Twitter --> <meta name="twitter:card" content=""> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" MongoDB Replication | Idarlington "> <meta name="twitter:description" content=" About replication and Configuring a MongoDB replica set "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" MongoDB Replication | Idarlington "> <meta itemprop="description" content=" About replication and Configuring a MongoDB replica set "> <meta itemprop="image" content="http://localhost:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/2016/mongodb-replication/"> <link rel="alternate" type="application/rss+xml" title="Idarlington" href="http://localhost:4000/feed.xml"> <script type="text/javascript"> var disqus_shortname = 'idarlington'; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-50842645-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"> </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} }); </script> </head> <body> <main id="site-top" class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/">Idarlington</a></h1> <ul class="navbar"> <li><a href="/tags">tags</a></li> <li><a href="/about">about</a></li> <li><a href="/feed.xml" target="_blank">feed</a></li> </ul> </div> </nav> </header> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80946846-1', 'auto'); ga('send', 'pageview'); </script> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">MongoDB Replication</h1> <p class="post-meta"> <a class="tag" href="/tags#MongoDB">MongoDB</a> | <time datetime="2016-11-14T00:00:00+01:00" itemprop="datePublished">Nov 14, 2016</time> </p> </header> <div class="post-content" itemprop="articleBody"> <style> ul { list-style-type: square; margin-bottom: 10px; padding-left: 30px; } ol { list-style-type: decimal; margin-bottom: 10px; padding-left: 30px; } h3 strong { font-weight:normal; } </style> <h2 id="replication">Replication?</h2> <blockquote> <p>Replication provides redundancy and increases data availability. With multiple copies of data on different database servers, replication provides a level of fault tolerance against the loss of a single database server.</p> <p>— <em>MongoDB Manual</em></p> </blockquote> <p>A replica set in MongoDB is a group of mongod instances that maintain the same data set. The mongod instances are known as nodes. Nodes could be primary or secondary.</p> <p>By default write operations are performed on the primary node and synced to other secondary nodes. Read operations are also performed on the primary node by default but the configuration on read operations can be changed.</p> <div style="text-align:center"> <p><img src="/assets/images/mongo-replication.png" alt="MongoDB replication" title="Replica set example" /></p> </div> <h2 id="benefits-of-replication">Benefits of replication</h2> <ul> <li>High availability &amp; redundancy</li> <li>Distributes database requests, therefore, could increase application’s speed (has to be configured)</li> </ul> <h2 id="setting-up-a-replica-set">Setting Up a Replica Set</h2> <ol> <li> <h4 id="set-up-mongodb-on-the-servers-"><em>Set Up MongoDB on the servers</em> :</h4> <p><a href="https://docs.mongodb.com/v3.0/tutorial/install-mongodb-on-ubuntu/">Mongod instances</a> need to be setup on the servers you plan to use in the replica set.</p> <p>Ideally, a replica set is to have an odd number of mongod instances; this is to ensure that during an election for a master mongod instance, quorom can be reached. If you can only set up even mongod instances, then you have to add an arbiter. The minimum number of mongod instances is three, if you can only setup two, then you have to add an arbiter.</p> <p>Arbiters are mongod instances that are part of a replica set but do not hold data. Arbiters participate in elections in order to break ties.</p> <p>I have seen a few cases where all mongod instances of a replica set are setup on a single server, I think it beats the purpose of setting up a replica set. If that server goes down, then your MongoDB server becomes unavailable.</p> </li> <li> <h3 id="check-connection-between-mongod-instances-"><em>Check connection between Mongod instances</em> :</h3> <p>The connection between the Mongod instances on the different servers needs to be tested and confirmed. This is important if you use a firewall on your servers. I have had cases where I setup a replica set and it wasn’t working only to find out the connection port between the Mongod instances was blocked.</p> <p>The hostname of the servers where other Mongod instances are located needs to be added to each server’s <code class="highlighter-rouge">/etc/hosts</code>. For a server with hostname <code class="highlighter-rouge">idarlington</code> and ip <code class="highlighter-rouge">192.168.2.218</code>, it should be added as :</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">192.168.2.218 idarlington</code></pre></figure> </li> <li> <h3 id="set-up-configuration-file-"><em>Set up configuration file</em> :</h3> <p>After confirming the connection between the Mongod instances, you can now begin the replica set setup proper. You need to edit the MongoDB conf file that starts the Mongod service.</p> <p>For most linux systems the conf file is located in the <code class="highlighter-rouge">/etc/init</code>. For <strong>MongoDB 2.4 and lower</strong>, the file is <code class="highlighter-rouge">mongodb.conf</code> while for <strong>MongoDB 2.6 and above</strong>, the file is <code class="highlighter-rouge">mongod.conf</code></p> <p>For <strong>MongoDB version 2.6 and above</strong></p> <figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">replication.replSetName</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">replset</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">chosen"</span></code></pre></figure> <p>OR</p> <figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">replication</span><span class="pi">:</span>
   <span class="na">replSetName </span><span class="pi">:</span> <span class="s2">"</span><span class="s">replset</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">you</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">chosen"</span></code></pre></figure> <p>For <strong>MongoDB 2.4 and below</strong></p> <figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="s">replSet  = "replset name you have chosen"</span></code></pre></figure> </li> <li> <h3 id="initiate-replica-set-"><em>Initiate Replica Set</em> :</h3> <p>You can now exit the conf file and start a mongo shell on the server you want to be the primary node.</p> <figure class="highlight"><pre><code class="language-zsh" data-lang="zsh">  Mongo
  </code></pre></figure> <p>Then to initiate the replica set :</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">rs.initiate<span class="o">()</span></code></pre></figure> <p>To show the configuration of the replica set :</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh"> rs.conf<span class="o">()</span> </code></pre></figure> <p>To show the recent status of the replica set :</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">rs.status<span class="o">()</span></code></pre></figure> </li> <li> <h3 id="add-other-members-"><em>Add other members</em> :</h3> <p>After initiating the replica set, its only member is the current server where you are running the mongo shell. To add other members to the replica set, use the IP address or hostname of the server with the mongod instance you want to add like</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">  rs.add<span class="o">(</span><span class="s2">"192.168.2.128"</span><span class="o">)</span>
  </code></pre></figure> </li> <li> <h3 id="adding-an-arbiter-"><em>Adding an arbiter</em> :</h3> <p>Arbiters are useful when you have an even number of nodes, if you already have an odd number of nodes, it is not needful. To add an arbiter, you can either use its hostname or ip address.</p> <figure class="highlight"><pre><code class="language-sh" data-lang="sh">  rs.addArb<span class="o">(</span><span class="s2">"192.168.2.13"</span><span class="o">)</span>
  </code></pre></figure> </li> </ol> <h2 id="notes">Notes</h2> <ul> <li>If you formerly built your application to work with a standalone MongoDB server, you have to update your mongodb connection to work with a replica set. The way to do this differs with the ORM or driver you use for your application.</li> <li>You can set read preference on your application. The available options are <code class="highlighter-rouge">primary</code>, <code class="highlighter-rouge">primaryPrefered</code>, <code class="highlighter-rouge">secondary</code>, <code class="highlighter-rouge">secondaryPrefered</code>, <code class="highlighter-rouge">nearest</code>.</li> </ul> <aside class="share"> <h4>Share this.</h4> <a href="http://twitter.com/share?text=MongoDB Replication&amp;url=http://localhost:4000/2016/mongodb-replication/&amp;hashtags=MongoDB&amp;via=idarlington" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">Twitter</a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/mongodb-replication/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=235');return false;">Facebook</a> </aside> </div> </article> <aside id="comments" class="disqus"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_config = function () { this.page.url = 'http://localhost:4000/2016/mongodb-replication/'; this.page.identifier = '/2016/mongodb-replication'; }; (function() { var d = document, s = d.createElement('script'); s.src = '//'+ 'idarlington' + '.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="pull-left">&copy;2018 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small> </div> </footer> </main> </body> </html>
